<script src="https://public.tableau.com/javascripts/api/tableau-2.9.1.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<div id="wrapper">
  <!-- <div class="loading">
    <span></span><span></span><span></span>
  </div>
  <style>
    .loading {
      background-color: #005077;
      width: 60px;
      height: 100px;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
    }

    .loading span {
      display: inline-block;
      width: 25%;
      height: var(--height);
      background-color: white;
    }

    .loading span:nth-of-type(1) {
      animation: anime1 1s ease-in-out infinite;
    }

    .loading span:nth-of-type(2) {
      animation: anime1 1s ease-in-out .15s infinite;
    }

    .loading span:nth-of-type(3) {
      animation: anime1 1s ease-in-out .3s infinite;
    }

    @keyframes anime1 {
      from {
        height: var(--height);
      }

      40% {
        height: 100%;
      }

      80% {
        height: var(--height);
      }

      to {
        height: var(--height);
      }
    }
  </style> -->
  <div id="mavQContainer">
    <div id="mainContent">
      <div id="sidebar">
        <div id="buttons">
          <span id="downloads">
            <i class="fa-solid fa-file-pdf" onclick="downloadPDF()" data-title="Download PDF"></i>
            <i class="fa-solid fa-file-excel" onclick="downloadExcel()" data-title="Download Excel"></i>
            <i class="fa-solid fa-file-powerpoint" onclick="downloadPowerPoint()" data-title="Download PowerPoint"></i>
          </span>
          <button id="resetDashboard">
            <p id="resetArrow">↺</p>RESET
          </button>
          <div id="tableauToolbar">
            <i class="fa-solid fa-backward" data-title="Undo" onclick="onUndoClick()"></i>
            <i class="fa-solid fa-forward" data-title="Redo" onclick="onRedoClick()"></i>
            <i class="fa-solid fa-share-from-square" data-title="Share" onclick="onShareClick()"></i>
            <i class="fa-solid fa-download" data-title="Download" onclick="onDownloadClick()"></i>
            <i class="fa-solid fa-expand" data-title="Fullscreen Toggle" onclick="onFullscreenClick()"></i>
          </div>
        </div>
        <div id="navPanel">
          <div class="navRadioButton" onclick="onSwitchDashboard()" onmouseenter="onRadioButtonMouseEnter()"
            onmouseleave="onRadioButtonMouseLeave()">
            <span class="radioTextContainer">
              <p class="code">NY_01</p>
              <p class="radioText">List of Filers</p>
            </span>
            <input type="radio">
            <span class="arrowBackground">
              <span class="arrow"></span>
            </span>
          </div>
          <div class="navRadioButton" onclick="onSwitchDashboard()" onmouseenter="onRadioButtonMouseEnter()"
            onmouseleave="onRadioButtonMouseLeave()">
            <span class="radioTextContainer">
              <p class="code">NY_02</p>
              <p class="radioText">Independent Expenditures</p>
            </span>
            <input type="radio">
            <span class="arrowBackground">
              <span class="arrow"></span>
            </span>
          </div>
          <div class="navRadioButton" onclick="onSwitchDashboard()" onmouseenter="onRadioButtonMouseEnter()"
            onmouseleave="onRadioButtonMouseLeave()">
            <span class="radioTextContainer">
              <p class="code">NY_99</p>
              <p class="radioText">Glossary</p>
            </span>
            <input type="radio">
            <span class="arrowBackground">
              <span class="arrow"></span>
            </span>
          </div>
        </div>
        <div id="filters">
          <span class="filter">
            <label class="filterLabel" for="filerType">Filer Type</label>
            <input type="text" id="filerType" class="filterInput" placeholder="empty" onkeyup="onTableFilterChanged()"
              column-index="1" />
            <select class="filterSelect" onchange="updateFilterInput()" column-index="1"><option value="">None</option></select>
            <!-- <div class="selectionOptions">
              <p><input type="checkbox" onchange="updateFilterInput()">option</p>
            </div> -->
            <div class="filterIcon" onclick="showOptions()"><span class="material-icons">filter_list</span></div>
          </span>
          <span class="filter">
            <label class="filterLabel" for="complianceType">Compliance Type</label>
            <input type="text" id="complianceType" class="filterInput" placeholder="empty" onkeyup="onTableFilterChanged()"
              column-index="3" />
            <select class="filterSelect" onchange="updateFilterInput()" column-index="3"><option value="">None</option></select>
            <div class="filterIcon" onclick="showOptions()"><span class="material-icons">filter_list</span></div>
          </span>
          <span class="filter">
            <label class="filterLabel" for="committeeType">Committee Type</label>
            <input type="text" id="committeeType" class="filterInput" placeholder="empty" onkeyup="onTableFilterChanged()"
              column-index="4" />
            <select class="filterSelect" onchange="updateFilterInput()" column-index="4"><option value="">None</option></select>
            <div class="filterIcon" onclick="showOptions()"><span class="material-icons">filter_list</span></div>
          </span>
          <span class="filter">
            <label class="filterLabel" for="county">County</label>
            <input type="text" id="county" class="filterInput" placeholder="empty" onkeyup="onTableFilterChanged()"
              column-index="5" />
            <select class="filterSelect" onchange="updateFilterInput()" column-index="5"><option value="">None</option></select>
            <div class="filterIcon" onclick="showOptions()"><span class="material-icons">filter_list</span></div>
          </span>
          <span class="filter">
            <label class="filterLabel" for="yearOfRegistration">Registration Date</label>
            <input type="text" id="yearOfRegistration" class="filterInput" placeholder="empty"
              onkeyup="onTableFilterChanged()" column-index="6" />
            <select class="filterSelect" onchange="updateFilterInput()" column-index="6"> </select>
            <div class="filterIcon" onclick="showOptions()"><span class="material-icons">filter_list</span></div>
          </span>
          <span class="filter">
            <label class="filterLabel" for="office">Office</label>
            <input type="text" id="office" class="filterInput" placeholder="empty" onkeyup="onTableFilterChanged()"
              column-index="7" />
            <select class="filterSelect" onchange="updateFilterInput()" column-index="7"><option value="">None</option></select>
            <div class="filterIcon" onclick="showOptions()"><span class="material-icons">filter_list</span></div>
          </span>
        </div>
      </div>
      <div id="vizContainer">
        <div id="tableauViz"></div>
        <div id="toolbarBlocker"></div>
        <div id="detailedTable">
          <p id="detailedTableBanner">List of Filers - Detailed Table</p>
          <div id="tableDiv">
            <table id="table">
              <colgroup></colgroup>
              <thead></thead>
              <tbody></tbody>
            </table>
          </div>
          <div id="tableControls">
            <p id="amountOfRowsToDisplay">Number of Rows:</p>
            <select id="rowAmountSelect" onchange="onRowAmountChange(this.value)">
              <option value="10">10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="250">250</option>
              <option value="500">500</option>
              <option value="1000">1000</option>
            </select>
            <p id="currentRowIndexCount">Loading table rows...</p>
            <button class="tableButton" onclick="onTableBackClick()">Back</button>
            <button class="tableButton" onclick="onTableNextClick()">Next</button>
            <input type="text" id="viewRowSearch" placeholder="Row Number" onkeyup="onRowSearchKeyUp(this.value)" />
          </div>
        </div>
      </div>
    </div>
    <!-- <div id="footer">
      <a id="poweredContainer" href="https://mavq.com" target="_blank" rel="noopener">
        <p id="poweredText">Powered by</p>
        <img src="https://mavq.com/assets/images/logo.png">
      </a>
      <p id="copyright">© 2022 Maverick Quantum Inc. All rights reserved</p>
    </div> -->
  </div>
  <style>
    * {
      box-sizing: border-box;
    }

    #wrapper {
      margin: 0 15px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #mavQContainer {
      color: black;
      background-color: white;
      font-size: 15px;
      font-family: Arial, Helvetica, sans-serif;
      display: flex;
      flex-direction: column;
      transform-origin: top left;
      scale: .80;
      width: 1720px;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 0 6px 0 rgba(0, 0, 0, .2);
      overflow: hidden;
      scroll-behavior: none;
      visibility: hidden;
    }

    #mainContent {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: row;
      flex: 1 0 auto;
    }

    #sidebar {
      margin: 0 3px 0 12px;
      min-width: 210px;
      z-index: 1;
      flex: 1 0 auto;
    }

    #vizContainer {
      margin: 0;
      padding: 0;
    }

    #toolbarBlocker {
      background-color: white;
      position: relative;
      top: -75px;
      height: 28px;
      z-index: 1;
    }

    #detailedTable {
      background-color: white;
      margin: -125px 30px 30px 30px;
      position: relative;
      border-radius: 15px;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
      z-index: 2;
    }

    #detailedTableBanner {
      margin: 0;
      background-color: #71aec6;
      width: 100%;
      height: 60px;
      font-size: 15pt;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      border-radius: 15px 15px 0 0;
    }

    #buttons {
      background-color: #f7f7f7;
      margin: 12px 0 0 0;
      display: flex;
      flex-direction: column;
      padding: 12px;
      border-radius: 15px;
      box-sizing: border-box;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
    }

    #downloads {
      background-color: white;
      margin: 0;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      font-size: 30pt;
      padding: 12px;
      border-radius: 15px;
      box-sizing: border-box;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
    }

    #downloads i {
      cursor: pointer;
    }

    #downloads i:hover {
      color: #007097;
      transition: all 0.1s ease-in-out;
    }

    #downloads i:active {
      color: #005077;
      transition: all 0.1s ease-in-out;
    }

    .fa-file-pdf {
      color: #973126;
    }

    .fa-file-excel {
      color: #0a9544;
    }

    .fa-file-powerpoint {
      color: #e74c3c;
    }

    #resetDashboard {
      z-index: 1;
      margin: 12px 0 0 0;
      color: black;
      background-color: white;
      cursor: pointer;
      border-radius: 12px;
      border: none;
      height: 60px;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
      font-weight: bold;
      font-size: 15pt;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
    }

    #resetDashboard:hover {
      box-shadow: 0 3px 4px 1px rgba(0, 0, 0, .18);
      transition: all 0.1s ease-in-out;
    }

    #resetDashboard:active {
      box-shadow: inset 0 2px 2px 1px rgba(0, 0, 0, .18);
      transition: all 0.1s ease-in-out;
    }

    #resetArrow {
      position: relative;
      top: -3px;
      padding: 0 12px 0 0;
      font-size: 24px;
    }

    #resetArrow {
      top: -2px;
    }

    #navPanel {
      all: unset;
      display: flex;
      flex-direction: column;
      margin: 42px 0 auto 0;
      border-radius: 15px;
      border: 1px solid #ccc;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
      overflow: hidden;
    }

    .navRadioButton {
      all: unset;
      margin: 0;
      padding: 0;
      height: 100px;
      display: flex;
      flex-direction: row;
      border: none;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
      background-color: white;
    }

    .navRadioButton input {
      position: absolute;
      opacity: 0;
      cursor: pointer;
      pointer-events: none;
    }

    .radioTextContainer {
      all: unset;
      margin: 0;
      padding: 0;
      width: 180px;
      position: relative;
      pointer-events: none;
    }

    .radioText {
      margin: 0;
      pointer-events: none;
      position: absolute;
      top: 40px;
      left: 9px;
      line-height: 1.25;
      width: 170px;
      height: 100px;
    }

    .code {
      all: unset;
      position: absolute;
      top: 9px;
      left: 9px;
      color: #999;
    }

    .arrowBackground {
      margin: 0;
      pointer-events: none;
      background-color: #f7f7f7;
      width: 30px;
      min-width: 30px;
      height: 100px;
      position: relative;
      top: 0;
      right: 0;
    }

    .arrow {
      border: solid #007097;
      border-width: 0 2px 2px 0;
      display: inline-block;
      padding: 6px;
      transform: rotate(-45deg);
      -webkit-transform: rotate(-45deg);
      position: relative;
      top: 35px;
      left: 3px;
    }

    .star {
      position: relative;
      top: 8px;
      left: -100px;
      color: #E8B915;
      pointer-events: none;
    }

    #tableauToolbar {
      color: #ccc;
      background-color: white;
      margin: 12px 0 0 0;
      height: 60px;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      font-size: 18pt;
      padding: 12px;
      border-radius: 15px;
      box-sizing: border-box;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
    }

    #tableauToolbar i:hover {
      color: #007097;
      cursor: pointer;
      transition: all 0.1s ease-in-out;
    }

    #tableauToolbar i:active {
      color: #005077;
      transition: all 0.1s ease-in-out;
    }

    [data-title]:hover:after {
      opacity: 1;
      transition: all 0.1s ease 0.25s;
      visibility: visible;
    }

    [data-title]:after {
      content: attr(data-title);
      background-color: white;
      font-size: 9pt;
      position: absolute;
      padding: 6px;
      bottom: -1.6em;
      left: 100%;
      white-space: nowrap;
      opacity: 0;
      box-shadow: 0 1px 3px 1px rgba(0, 0, 0, .18);
      border-radius: 6px;
      z-index: 99999;
      visibility: hidden;
      font-family: Arial, Helvetica, sans-serif;
    }

    [data-title] {
      position: relative;
    }

    #footer {
      background-color: rgb(12, 12, 35);
      color: rgb(121, 128, 171);
      text-align: center;
      position: relative;
      flex-shrink: 0;
    }

    #poweredContainer {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      margin: 6px 0;
      text-decoration: none;
      color: rgb(121, 128, 171);
    }

    #poweredText {
      padding: 0 12px 0 0;
      position: relative;
      top: 12px;
    }

    #footerLogo {
      margin: 0;
      pointer-events: none;
      width: 100px;
    }

    #copyright {
      margin: 0 0 6px 0;
      color: rgb(121, 128, 171)
    }


    /************ TABLE STYLES ************/
    #filters {
      margin: 788px 0 0 0;
    }

    .filter {
      background-color: #f7f7f7;
      position: relative;
      display: flex;
      margin: 24px 0;
      padding: 9px;
      flex-direction: column;
      border-radius: 12px;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
    }

    .filter:hover {
      box-shadow: 0 2px 4px 2px rgba(0, 0, 0, .18);
    }

    .filterIcon {
      color: #aaa;
      position: absolute;
      right: 15px;
      bottom: 15px;
      height: 21px;
      width: 21px;
      border-radius: 50%;
      pointer-events: none;
    }
    /* .filterIcon:hover {
      background-color: #a0a0a0;
      cursor: pointer;
      transition: all 0.1s ease-in-out;
    } */

    .filterLabel {
      margin: 0 0 0 3px;
    }

    .filterInput {
      height: 30px;
      margin: 6px 0 0 0;
      padding: 0 0 0 9px;
      border: none;
      border-radius: 6px;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
    }

    .filterInput::placeholder {
      color: #aaa;
      font-style: italic;
    }

    .filterInput:focus {
      outline: #007097 auto 1px;
    }

    .filterSelect {
      background-color: red;
      position: absolute;
      right: 13px;
      bottom: 13px;
      height: 21px;
      width: 21px;
      opacity: 0;
      cursor: pointer;
    }

    #tableControls {
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: 0 12px;
      height: 69px;
      width: 100%;
      border-top: 1px solid #ddd;
    }

    #amountOfRowsToDisplay {
      display: flex;
      align-items: center;
      margin: 0 12px 0 0;
    }

    #rowAmountSelect {
      width: 60px;
      height: 24px;
      margin: 0 12px 0 0;
      border: none;
      border-bottom: 2px solid black;
    }

    #rowAmountSelect:focus {
      outline: rgba(0, 0, 0, 0) auto 1px;
      border-bottom: 2px solid #007097;
    }

    .tableButton {
      background-color: white;
      border: none;
      padding: 0 12px;
      height: 40px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      margin: 0 12px 0 0;
      cursor: pointer;
      border-radius: 6px;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
    }

    .tableButton:hover {
      box-shadow: 0 3px 4px 1px rgba(0, 0, 0, .18);
      transition: all 0.2s ease-in-out;
    }

    .tableButton:active {
      box-shadow: inset 0 1px 2px 1px rgba(0, 0, 0, .18);
      transition: all 0.2s ease-in-out;
    }

    #viewRowSearch {
      width: 120px;
      height: 40px;
      padding: 0 12px;
      margin: 0;
      border: none;
      border-radius: 6px;
      box-shadow: 0 1px 4px 1px rgba(0, 0, 0, .18);
    }

    #viewRowSearch::placeholder {
      color: #aaa;
      font-style: italic;
    }

    #viewRowSearch:focus {
      outline: #007097 auto 1px;
    }

    #currentRowIndexCount {
      display: flex;
      align-items: center;
      margin: 0 12px 0 auto;
    }

    #tableDiv {
      margin: 0;
      padding: 0;
      font-family: Arial, Helvetica, sans-serif;
      height: 600px;
      max-width: 1440px;
      overflow: scroll;
      overflow-x: scroll;
    }

    table {
      table-layout: fixed;
      margin: 0;
      border-spacing: 0;
      border-collapse: collapse;
    }

    col {
      min-width: 100px;
      max-width: 600px;
    }

    thead {
      background-color: white;
      margin: 0;
      position: sticky;
      top: 0px;
      height: 60px;
    }

    tbody {
      margin: 0;
    }

    th,
    td {
      font-size: 10pt;
      margin: 0;
      padding: 6px;
      border-right: 1px solid #ddd;
      border-bottom: 1px solid #ddd;
    }

    th {
      position: relative;
      font-size: 12pt;
      height: 60px;
      padding: 6px;
      border-bottom: 2px solid black;
    }

    .handle {
      position: absolute;
      top: 0;
      right: -2px;
      width: 4px;
      height: 100%;
      cursor: col-resize;
      opacity: 0;
    }

    .handle:hover {
      background-color: black;
      opacity: 1;
    }
  </style>

  <script>
    var placeholderDiv = document.getElementById("tableauViz");
    var mavQContainer = document.getElementById("mavQContainer");
    var currentRowIndexCount = document.getElementById("currentRowIndexCount");
    var tableDiv = document.getElementById("tableDiv");
    var table = document.getElementById("table");
    var colgroup = table.querySelector("colgroup");
    var thead = tableDiv.querySelector("thead");
    var viz;
    var sheet;
    var dataTable;
    var data;
    var columns;
    var currentRowIndex = 0;
    var amountOfRowsToDisplay = 10;
    var initialColWidth;
    var minCellWidth = 100;
    var filteredData;
    var tableOptions = {
      maxRows: 0,
      ignoreAliases: false,
      ignoreSelection: true,
      includeAllColumns: false
    };

    var heights = [1475, 1825, 1125];
    var urls = [
      "https://public.tableau.com/views/ListofFilersDashboard_Version_2/Dashboard1",
      "https://public.tableau.com/views/Independent_ExpenditureDashboard/Dashboard1",
      "https://public.tableau.com/views/NYSGlossary/Dashboard1"
    ];
    var options = {
      hideTabs: true,
      width: "1500px",
      height: "1475px",
      onFirstInteractive: function () {
        sheet = viz.getWorkbook().getActiveSheet();
        var resetButton = document.getElementById("resetDashboard");
        var url = sheet.getUrl();
        var index = urls.indexOf(url);

        if (index === 0) getUnderlyingData();

        resetButton.addEventListener("click", (index) => { switchDashboard(index) });
      }
    };

    viz = new tableau.Viz(placeholderDiv, urls[0], options);
    viz.addEventListener('filterchange', onFilterChange);
    viz.addEventListener('marksselection', onFilterChange);
    viz.addEventListener('parametervaluechange', onFilterChange);
    viz.addEventListener('tabswitch', onTabSwitch);

    window.onload = () => {
      mavQContainer.style.visibility = "visible";
      fixMargin();
    };
    window.addEventListener("resize", fixMargin);
    var minScale = .08;
    var maxScale = .80;
    function fixMargin() {
      var style = getComputedStyle(mavQContainer);
      var width = parseFloat(style.width);
      var height = parseFloat(style.height);

      var scale = window.innerWidth / 1738;
      if (scale < minScale) scale = minScale;
      else if (scale > maxScale) scale = maxScale;
      else scale = scale;

      mavQContainer.style.scale = scale + "";
      mavQContainer.style.marginRight = "-" + (width - width * scale) + "px";
      mavQContainer.style.marginBottom = "-" + (height - height * scale) + "px";
    }

    var radioButtons = document.getElementsByClassName("navRadioButton");
    if (radioButtons.length === 1) radioButtons[0].style.border = "none";
    else radioButtons[radioButtons.length - 1].style.border = "none";

    checkRadioButton(radioButtons[0]);

    function onTabSwitch() {
      var url = viz.getWorkbook().getActiveSheet().getUrl();
      for (var i = 0; i < radioButtons.length; i++) {
        if (urls[i] != url) continue;
        uncheckRadioButtons();
        checkRadioButton(radioButtons[i]);
        return;
      }
    }

    function onSwitchDashboard() {
      for (var i = 0; i < radioButtons.length; i++) {
        if (radioButtons[i] != event.target) continue;
        switchDashboard(i);
        break;
      }
      uncheckRadioButtons();
      checkRadioButton(event.target);
    }

    function switchDashboard(i) {
      viz.removeEventListener('filterchange', onFilterChange);
      viz.removeEventListener('marksselection', onFilterChange);
      viz.removeEventListener('parametervaluechange', onFilterChange);
      viz.removeEventListener('tabswitch', onTabSwitch);
      viz.dispose();

      if (i === 0) toggleDetailedTable(true);
      else toggleDetailedTable(false);

      options.height = heights[i] + "px";
      viz = new tableau.Viz(placeholderDiv, urls[i], options);
      viz.addEventListener('filterchange', onFilterChange);
      viz.addEventListener('marksselection', onFilterChange);
      viz.addEventListener('parametervaluechange', onFilterChange);
      viz.addEventListener('tabswitch', onTabSwitch);

      var resetButton = document.getElementById("resetDashboard");
      resetButton.style.backgroundColor = "white";
      resetButton.style.color = "black";
    }

    function toggleDetailedTable(toggle) {
      var detailedTable = document.getElementById("detailedTable");
      if (toggle) {
        detailedTable.style.display = "block";
        return;
      }
      detailedTable.style.display = "none";
    }

    function onFilterChange() {
      var resetButton = document.getElementById("resetDashboard");
      resetButton.style.backgroundColor = "#800000";
      resetButton.style.color = "white";
    }

    function checkRadioButton(button) {
      button.querySelector('input').checked = true;
      button.style.backgroundColor = "#007097";
      button.style.color = "white";
      button.getElementsByClassName("arrowBackground")[0].style.backgroundColor = "#035876";
      button.getElementsByClassName("arrow")[0].style.borderColor = "white";
    }

    function uncheckRadioButtons() {
      var radioButtons = document.getElementsByClassName("navRadioButton");
      for (var i = 0; i < radioButtons.length; i++) {
        radioButtons[i].querySelector('input').checked = false;
        radioButtons[i].style.backgroundColor = "#fff";
        radioButtons[i].style.color = "black";
        radioButtons[i].getElementsByClassName("arrowBackground")[0].style.backgroundColor = "#F7F7F7";
        radioButtons[i].getElementsByClassName("arrow")[0].style.borderColor = "rgb(74, 109, 147)";
      }
    }

    function onRadioButtonMouseEnter() {
      if (!event.target.querySelector('input').checked) {
        event.target.style.backgroundColor = "#f2f2f2";
        event.target.getElementsByClassName("arrowBackground")[0].style.backgroundColor = "#f2f2f2";
      }
    }

    function onRadioButtonMouseLeave() {
      if (!event.target.querySelector('input').checked) {
        event.target.style.backgroundColor = "#fff";
        event.target.getElementsByClassName("arrowBackground")[0].style.backgroundColor = "#f7f7f7";
      }
    }

    function downloadPDF() {
      viz.showExportPDFDialog();
    }

    function downloadExcel() {
      var checkedButton = document.querySelector('input[type="radio"]:checked');
      var code = checkedButton.parentNode.querySelector('.code').innerHTML;
    }

    function downloadPowerPoint() {
      viz.showExportPowerPointDialog();
    }

    function onUndoClick() {
      viz.undoAsync();
    }

    function onRedoClick() {
      viz.redoAsync();
    }

    function onShareClick() {
      viz.showShareDialog();
    }

    function onDownloadClick() {
      viz.showDownloadDialog();
    }

    var isFullscreen = false;
    function onFullscreenClick() {
      if (document.fullscreenElement) {
        document.exitFullscreen();
        return;
      }
      window.removeEventListener("resize", fixMargin);
      mavQContainer.requestFullscreen();
    }

    mavQContainer.addEventListener('fullscreenchange', (event) => {
      if (document.fullscreenElement) {
        mavQContainer.style.position = "absolute";
        mavQContainer.style.overflow = "scroll";
        mavQContainer.style.scrollBehavior = "unset";
        mavQContainer.style.alignItems = "center";
        mavQContainer.style.zIndex = "999999";
        mavQContainer.style.scale = "unset";
        return;
      }
      mavQContainer.style.position = "relative";
      mavQContainer.style.overflow = "hidden";
      mavQContainer.style.scrollBehavior = "none";
      mavQContainer.style.alignItems = "unset";
      mavQContainer.style.zIndex = "unset";
      mavQContainer.style.scale = ".80";
      window.addEventListener("resize", fixMargin);
      fixMargin();
    });

    async function getUnderlyingData() {
      sheet = sheet.getWorksheets().get("IE Expenditures and Payments");
      sheet.getUnderlyingTablesAsync().then(tables => {
        return sheet.getUnderlyingTableDataAsync(tables[0].getTableId(), tableOptions).then(dataTable => {
          data = dataTable.getData();
          filteredData = dataTable.getData();
          columns = dataTable.getColumns();
          initialColWidth = table.clientWidth / columns.length;
          writeColumnHeaders();
          displayRangeInHTMLTable(0, amountOfRowsToDisplay - 1);
        });
      });
    }

    function writeColumnHeaders() {
      columns.forEach(column => {
        var handle;
        var th = document.createElement("th");
        var col = document.createElement("col");
        colgroup.appendChild(col);

        var isLastColumn = column.getIndex() == columns.length - 1;
        th.style.borderRight = isLastColumn ? "none" : "1px solid #ddd";
        // handle = isLastColumn ? '' : '<div class="handle" onmousedown="startResize(event)"></div>';

        th.innerHTML = column.getFieldName();
        thead.appendChild(th);
        populateFilterSelectWithOptions(column);
      });
    }

    function populateFilterSelectWithOptions(column) {
      var selects = document.getElementsByClassName("filterSelect");
      var select;
      for (var i = 0; i < selects.length; i++) {
        if (selects[i].getAttribute("column-index") == column.getIndex()) {
          select = selects[i];
          break;
        }
      }
      if (!select) return;
      select.selectedIndex = -1;
      
      var options = [];
      for (var i = 0; i < data.length; i++) {
        var value = data[i][column.getIndex()].formattedValue;
        if (value == null) continue;
        if (options.indexOf(value) == -1) options.push(value);
      }
      options.forEach((option, index) => {
        var optionElement = document.createElement("option");
        optionElement.innerHTML = option;
        select.appendChild(optionElement);
      });
    }

    function updateFilterInput() {
      var select = event.target;
      var input = select.parentNode.querySelector("input");
      input.value = select.value;
      onTableFilterChanged();
    }

    function showOptions() {
      var select = event.target.parentNode.querySelector("select");
      select.style.opacity = "1";
      select.dispatchEvent(new Event("onclick"));
    }

    function displayRangeInHTMLTable(startIndex, endIndex) {
      var tbody = tableDiv.querySelector("tbody");

      if (endIndex > filteredData.length) endIndex = filteredData.length;
      currentRowIndex = startIndex;
      currentRowIndexCount.innerHTML = "Showing " + (startIndex + 1) + " to " + (endIndex + 1) + " of " + filteredData.length + " rows";
      tbody.innerHTML = "";

      for (var i = startIndex; i < endIndex; i++) {
        var tr = document.createElement("tr");
        if (i % 2 == 0) tr.style.backgroundColor = "#f1f1f1";
        columns.forEach(column => {
          var td = document.createElement("td");
          if (column.getIndex() == columns.length - 1) td.style.borderRight = "none";
          td.innerHTML = filteredData[i][column.getIndex()].formattedValue;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      }
    }

    function onTableNextClick() {
      var startIndex = currentRowIndex + amountOfRowsToDisplay;
      var endIndex = currentRowIndex + amountOfRowsToDisplay * 2;
      if (endIndex >= filteredData.length) displayRangeInHTMLTable(filteredData.length - amountOfRowsToDisplay - 1, filteredData.length - 1);
      else displayRangeInHTMLTable(startIndex, endIndex);
    }

    function onTableBackClick() {
      if (currentRowIndex <= 0) return;
      var newTableView = currentRowIndex - amountOfRowsToDisplay;
      if (newTableView < 0) {
        displayRangeInHTMLTable(0, amountOfRowsToDisplay - 1);
        return;
      }
      displayRangeInHTMLTable(newTableView, newTableView + amountOfRowsToDisplay);
    }

    function onRowSearchKeyUp(row) {
      var rowNumber = parseInt(row);
      if (rowNumber < 1) return;
      if (!rowNumber) return;
      if (rowNumber >= filteredData.length) displayRangeInHTMLTable(filteredData.length - amountOfRowsToDisplay, filteredData.length);
      else displayRangeInHTMLTable(rowNumber - 1, rowNumber + amountOfRowsToDisplay - 1);
    }

    function onRowAmountChange(amount) {
      amountOfRowsToDisplay = parseInt(amount);
      displayRangeInHTMLTable(currentRowIndex, currentRowIndex + amountOfRowsToDisplay);
    }

    function onTableFilterChanged() {
      var filterInput = document.getElementsByClassName("filterInput");
      var filterValues = Array.from(filterInput).map(input => {
        return {
          column: parseFloat(input.getAttribute("column-index")),
          value: input.value
        }
      });

      filteredData = data.filter(row => {
        var rowMatches = true;
        filterValues.forEach(filter => {
          if (filter.value == "") return;
          if (row[filter.column].formattedValue.toLowerCase().includes(filter.value.toLowerCase()) == false) rowMatches = false;
        });
        return rowMatches;
      });
      displayRangeInHTMLTable(0, amountOfRowsToDisplay - 1);
    }

    function startResize(event) {
      const handle = event.target;
      const index = Array.from(thead.children).indexOf(handle.parentElement);
      const col = colgroup.children[index];
      const initialWidth = parseInt(col.clientWidth);
      const initialX = parseInt(event.clientX);

      mavQContainer.style.userSelect = 'none';

      document.addEventListener('mousemove', doResize);
      document.addEventListener('mouseup', stopResize);

      function doResize(event) {
        const newWidth = initialWidth + (event.clientX - initialX);
        col.style.width = `${newWidth}px`;
        console.log(newWidth);
        console.log(col.style.width);
      }
      function stopResize(event) {
        document.removeEventListener('mousemove', doResize);
        document.removeEventListener('mouseup', stopResize);
        mavQContainer.style.userSelect = 'unset';
      }
    }
  </script>